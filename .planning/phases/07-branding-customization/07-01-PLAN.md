---
phase: 07-branding-customization
plan: 01
type: execute
---

<objective>
Create business settings page with logo upload and tenant configuration.

Purpose: Allow tenants to customize their branding within tier limits (logo, contact details, bank info).
Output: Settings page with logo upload to Supabase Storage, API routes for tenant updates.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-extended-features/06-03-SUMMARY.md

**Existing infrastructure:**
- Supabase Storage already used for receipts (`lib/supabase-storage.ts`)
- Tenant schema has logo_url, primary_color, bank details columns
- TenantProvider has useBranding() hook ready
- useTenant() provides full tenant context

**Tier-gated branding:**
- All tiers: Business name, contact details, bank details
- Starter+: Logo upload
- Business+: Primary color customization (handled in 07-02)

@lib/supabase-storage.ts
@lib/tenant/types.ts
@lib/tenant/TenantProvider.tsx
@database/migrations/001_create_tenants.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tenant settings API routes</name>
  <files>
app/api/autow/tenant/settings/route.ts,
app/api/autow/tenant/logo/route.ts
  </files>
  <action>
Create two API routes:

1. **GET/POST /api/autow/tenant/settings** - Get and update tenant settings
   - GET: Return current tenant settings (business_name, email, phone, address, postcode, bank details)
   - POST: Update tenant settings, validate X-Tenant-Slug header matches authenticated tenant
   - Use withTenantSchema() for tenant context
   - Return updated tenant object

2. **POST /api/autow/tenant/logo** - Upload logo to Supabase Storage
   - Accept multipart/form-data with logo file
   - Use existing uploadToSupabase() pattern from lib/supabase-storage.ts
   - Store in `tenant-logos/{tenant_id}/{filename}` path
   - Update tenant.logo_url in database
   - Return signed URL for the uploaded logo
   - Delete old logo if exists before uploading new one

Security:
- Verify authenticated user belongs to tenant
- Validate file type (PNG, JPG, WEBP only)
- Max file size 2MB
  </action>
  <verify>
- curl GET /api/autow/tenant/settings returns tenant data
- curl POST with FormData uploads logo and returns URL
  </verify>
  <done>
- Settings GET/POST routes work
- Logo upload stores file and updates tenant
  </done>
</task>

<task type="auto">
  <name>Task 2: Create business settings page</name>
  <files>
app/[tenant]/settings/page.tsx
  </files>
  <action>
Create a comprehensive settings page with sections:

1. **Business Information**
   - Business Name (editable text)
   - Trade Type (display only - can't change after signup)
   - Subscription Tier (display with upgrade button placeholder)

2. **Logo Upload**
   - Current logo preview (or placeholder)
   - Upload button with file picker
   - Show upload progress
   - Preview new logo before saving
   - "Remove logo" option

3. **Contact Details**
   - Email, Phone, Address, Postcode
   - All editable

4. **Bank Details (for invoices)**
   - Bank Name, Account Name, Sort Code, Account Number
   - Note: "These appear on your invoices"

5. **Subscription Info** (read-only)
   - Current tier
   - Trial ends date (if trial)
   - Features included

Use glass UI style consistent with welcome page:
- Light blue background gradient
- White/blur cards
- Blue accent colors

Add save button that calls /api/autow/tenant/settings
Show success/error messages with toast-style notifications
  </action>
  <verify>npm run build succeeds, page renders at /[tenant]/settings</verify>
  <done>
- Settings page shows all tenant fields
- Logo upload works
- Save button updates tenant
- Success/error feedback shown
  </done>
</task>

<task type="auto">
  <name>Task 3: Add settings link to navigation</name>
  <files>
app/[tenant]/welcome/page.tsx,
lib/tenant/TenantProvider.tsx
  </files>
  <action>
1. Add settings path to useTenantPath():
   ```typescript
   settings: `/${tenant.slug}/settings`,
   ```

2. Add Settings card to welcome page grid:
   - Icon: gear/cog emoji
   - Title: "Settings"
   - Description: "Business details & branding"
   - Available to all tiers (no gating)
   - Place after existing cards but before Logout
  </action>
  <verify>npm run build succeeds, Settings card visible on welcome page</verify>
  <done>Settings link accessible from welcome page navigation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Settings API routes work (GET and POST)
- [ ] Logo upload stores file to Supabase Storage
- [ ] Settings page renders all tenant fields
- [ ] Changes save correctly to database
- [ ] Settings link visible on welcome page
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Logo upload works with Supabase Storage
- Settings page matches existing UI style
- Navigation updated
</success_criteria>

<output>
After completion, create `.planning/phases/07-branding-customization/07-01-SUMMARY.md`

Update STATE.md:
- Phase: 7 of 8 (Branding & Customization) â€” IN PROGRESS
- Plan: 07-01 complete, 07-02 ready
</output>
